const os = require('os');
const skyPathUtilities = require('../resources/utilities/sky-path-utilities.js');
const defaultMessageFrame = require('../resources/objects/DefaultMessageFrame.json');
let messageFrame = defaultMessageFrame;

/**
 * @description Initializing the message frame for each message that will logged afterwords.
 * There are certian fields that doesn't need to be configured more then once, because they are constant to the service level (as opposed to other fields that needs to be configured for each message).
 * Those fields are called the MessageFrame.
 * @param {JSON} objectMessageFrame An object that contains the fields that were mentioned above. To insert the object in the right form, it is recommended to use defaultMessageFrame - an available object in the same form.
 */
function initializeMessageFrame(objectMessageFrame) {
    messageFrame = objectMessageFrame;
}

function createLoggingMessage(logLevel, logString, item, tags) {
    let fullLogMessage = {};

    // Requierd Fields 
    fullLogMessage.timestamp = skyPathUtilities.dateMoment().format();
    fullLogMessage.logRecordId = skyPathUtilities.generateUUIDV4();
    fullLogMessage.logLevel = logLevel;
    fullLogMessage.microserviceData = messageFrame.microserviceData;
    fullLogMessage.microserviceData.podId = os.hostname();
    fullLogMessage.logString = logString;
    // Unrequierd Fields
    if (messageFrame.skypathMessageId)
        fullLogMessage.skypathMessageId = messageFrame.skypathMessageId;
    if (messageFrame.additionalIds)
        fullLogMessage.additionalIds = messageFrame.additionalIds;
    if (item)
        fullLogMessage.item = item;
    if (tags && messageFrame.tags) {
        fullLogMessage.tags = [...messageFrame.tags, ...tags];
    }
    else {
        if (tags)
            fullLogMessage.tags = tags;
        if (messageFrame.tags)
            fullLogMessage.tags = messageFrame.tags;
    }

    return fullLogMessage;
}

module.exports = {
    defaultMessageFrame,
    initializeMessageFrame,
    createLoggingMessage
}